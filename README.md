# OpenApi

## В этом проекте реализован пример работы с контрактами openapi

Контракт лежит в **pkg/api/openapi-objects.yaml**. В нём описна структура "object", которая имеет поля id, name, и два поля, которые несут значение ккординат. Этот объект представляет собой некую точку на карте условно с координатами. Так же в этом контракте описаны сценарии при запросе определённых URL и методов.

В проекте необходимо реализовать контракт. Изучив его, видно, что нужно реализовать методы на следующие запросы:

- URL "/objects" с POST методом - для создания новой точки
- URL "/objects" с GET методом - для получения всех имеющихся точек
- URL "/objects/{objectId}" - с GET методом - для получения конкретной точки
- URL "/objects/{objectId}" - с DELETE методом - для удаления конкретной точки
- URL "/objects/{objectId}/distance" - с GET методом - для расчёта расстояния между указанной точкой и переданными координатами

Для чего вообще нужен этот контракт?
Сгенерировав его, создастся файл, в котором будут лежать модели, каркас, адаптеры, клиент и интерфейсы, которые останется реализовать.
Сам вызов генератора и команда запуска лежит в файле **pkg/api/objapi/gen.go**. Все что находится после **go:generate** считается выполнимой командой и запускается. Эту команды для вызова генерации можно запустить с помощь утилиты **make**. Для этого и создан файл **Makefile**. Для этого достаточно запустить команду **make generate** или просто **go generate ./...**. В файле **config.yml** лежат настройки для генерации. Утилита **openapi-codegen** читает конфиг файл **pkg/api/objapi/config.yml** и генерирует модели и каркас на основе **openapi-objects.yaml**. Далее она сохраняет код в **pkg/api/objapi/api.gen.go**.
Таким запускается **openapi-codegen**

## Реализация

В **internal** созданы три пакета: для расчёта расстояния между двумя точками(**geo**); для обработки запросов(**handler**); для описания, хранения, поведения точки(**memstore**)

В **handler** есть файл **contracts.go**, в котором описан интерфейс. Он нужен для того, что не завязываться на способе хранения точек, который опоисан в **memstore**. Вместо него может быть какая-то БД, котооая будет соответсвовать данному интерфейсу. 

Точка запуска расположена в **cmd/objects-srv**

## Для запуска

В корневом репозитории необходимо запустить команду **go mod tidy**, чтобы скачать все зависимости.

Далее необходимо установить утилиты командной строки. Для этого можно воспользоваться командой **make install** или:

	go install github.com/deepmap/oapi-codegen/cmd/oapi-codegen@latest
	go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

Далее нужно запустить генерацию, проыец запуска описан выше. И можно запустить сервер.

## Для проверки

    curl -vvv -XPOST 'http://localhost:8181/api/v1/objects' -d '{"id": "1", "name": "object1", "lat": 58.481778, "lon": 41.532764}'

    curl -vv -XGET 'http://localhost:8181/api/v1/objects'

    curl -vvv -XGET 'http://localhost:8181/api/v1/objects/1/distance?Lat=55.784015&lon=37.470985'

    curl -vv -XDELETE 'http://localhost:8181/api/v1/objects/1'